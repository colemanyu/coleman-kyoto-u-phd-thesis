\begin{algorithm}[t]
\caption{Replace lines 3 to 9 in Algorithm~\ref{alg:psdtw-reuse-reaches}to reuse the computed sorted reaches $\tilde{\mathbbm{q}}_k$.}
\label{alg:psdtw-reuse-reaches}
\begin{algorithmic}[1]

{\color{blue}
\State $r'_{\mathrm{cache}} \gets -1$
{\color{black}
\For{$i \gets (p \cdot L_{\mathrm{gmin}}^Q)$ \textbf{to} $\min(p \cdot L_{\mathrm{gmax}}^Q, m)$}
    \For{$L^Q \gets L_{\mathrm{gmin}}^Q$ \textbf{to} $L_{\mathrm{gmax}}^Q$}
        \State $i' \gets i - L^Q$
        \State $Q' \gets \operatorname{rev}(Q(i'+1: i))$ 
        \State $L_{\min}^C \gets \max(L_{\mathrm{gmin}}^C, \ceil{L^Q/l})$
        \State $L_{\max}^C \gets \min(\floor{L^Q/l}, L_{\mathrm{gmax}}^C)$
        \State $r' \gets r \times \max(L^Q, L_{\max}^C)$ 
        {\color{blue}
        \If{$r'_{\mathrm{cache}} = r'$}
            \For{$k \gets 1$ \textbf{to} $L_{\max}^C$}
                \If{$k \leq |\mathbbm{Q}|$}
                    \State $e_\mathrm{prev} \gets \min(\floor{kl} + r', L^Q - 1)$
                    \State $e_\mathrm{new} \gets \min(\floor{kl} + r', L^Q)$
                    \If{$e_\mathrm{new} > e_\mathrm{prev}$}
                        \State $\tilde{\mathbbm{q}}_k \gets \tilde{\mathbbm{q}}_k \cup q'_{e_\mathrm{new}}$
                    \EndIf
                \Else
                    % $\mathbbm{q}_k \gets (q'_{\max(1, \ceil{k/l} - r')}, \ldots, q'_{\min(\floor{kl} + r', L^Q)})$
                    \State $\mathbbm{q}_k \gets (q'_{\max(1, \ceil{k/l} - r'}, \ldots,$
                    \Statex \hspace{14em} $q'_{\min(\floor{kl} + r', L^Q)})$ \Comment{$L^Q$ equals to $|Q'|$.}
                    \State $\tilde{\mathbbm{q}}_k \gets \operatorname{sort}(\mathbbm{q}_k)$
                \EndIf
            \EndFor
        \Else
            \For{$k \gets 1$ \textbf{to} $L_{\max}^C$}
                % $\mathbbm{q}_k \gets (q'_{\max(1, \ceil{k/l} - r')}, \ldots, q'_{\min(\floor{kl} + r', L^Q)})$
                \State $\mathbbm{q}_k \gets (q'_{\max(1, \ceil{k/l} - r')}, \ldots,$
                \Statex $\hspace{14em} q'_{\min(\floor{kl} + r', L^Q)})$
                \State $\tilde{\mathbbm{q}}_k \gets \operatorname{sort}(\mathbbm{q}_k)$
            \EndFor
            \State $r_{\mathrm{cache}} \gets r'$
        \EndIf
        }
    \EndFor
\EndFor
}
}
\end{algorithmic}
\end{algorithm}

